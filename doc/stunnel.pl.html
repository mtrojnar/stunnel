<?xml version="1.0" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv=content-type content="text/html; charset=ISO-8859-2">
<title>stunnel.8</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rev="made" href="mailto:root@localhost" />
</head>

<body style="background-color: white">


<!-- INDEX BEGIN -->
<div name="index">
<p><a name="__index__"></a></p>

<ul>

	<li><a href="#nazwa">NAZWA</a></li>
	<li><a href="#sk_adnia">SK£ADNIA</a></li>
	<li><a href="#opis">OPIS</a></li>
	<li><a href="#opcje">OPCJE</a></li>
	<li><a href="#plik_konfiguracyjny">PLIK KONFIGURACYJNY</a></li>
	<ul>

		<li><a href="#opcje_globalne">OPCJE GLOBALNE</a></li>
		<li><a href="#opcje_us_ug">OPCJE US£UG</a></li>
	</ul>

	<li><a href="#zwracana_warto__">ZWRACANA WARTO¦Æ</a></li>
	<li><a href="#przyk_ady">PRZYK£ADY</a></li>
	<li><a href="#pliki">PLIKI</a></li>
	<li><a href="#b__dy">B£ÊDY</a></li>
	<li><a href="#ograniczenia">OGRANICZENIA</a></li>
	<li><a href="#notki">NOTKI</a></li>
	<ul>

		<li><a href="#tryb_inetd__tylko_unix_">TRYB INETD (tylko Unix)</a></li>
		<li><a href="#certyfikaty">CERTYFIKATY</a></li>
		<li><a href="#losowo__">LOSOWO¦Æ</a></li>
	</ul>

	<li><a href="#zobacz_r_wnie_">ZOBACZ RÓWNIE¯</a></li>
	<li><a href="#autor">AUTOR</a></li>
</ul>

<hr name="index" />
</div>
<!-- INDEX END -->

<p>
</p>
<hr />
<h1><a name="nazwa">NAZWA</a></h1>
<p>stunnel - uniwersalny tunel protoko³u SSL</p>
<p>
</p>
<hr />
<h1><a name="sk_adnia">SK£ADNIA</a></h1>
<dl>
<dt><strong><a name="unix" class="item"><strong>Unix:</strong></a></strong></dt>

<dd>
<p><strong>stunnel</strong> [&lt;plik&gt;] | -fd&nbsp;n | -help | -version | -sockets</p>
</dd>
<dt><strong><a name="win32" class="item"><strong>WIN32:</strong></a></strong></dt>

<dd>
<p><strong>stunnel</strong> [ [-install | -uninstall | -start | -stop ]
    [-quiet] [&lt;plik&gt;] ] | -help | -version | -sockets</p>
</dd>
</dl>
<p>
</p>
<hr />
<h1><a name="opis">OPIS</a></h1>
<p>Program <strong>stunnel</strong> zosta³ zaprojektowany do opakowywania w protokó³ <em>SSL</em>
po³±czeñ pomiêdzy zdalnymi klientami a lokalnymi lub zdalnymi serwerami.
Przez serwer lokalny rozumiana jest aplikacja przeznaczona do uruchamiania
przy pomocy <em>inetd</em>.
Stunnel pozwala na proste zestawienie komunikacji serwerów nie posiadaj±cych
funkcjonalno¶ci <em>SSL</em> poprzez bezpieczne kana³y <em>SSL</em>.</p>
<p><strong>stunnel</strong> pozwala dodaæ funkcjonalno¶æ <em>SSL</em> do powszechnie stosowanych
demonów <em>inetd</em>, np. <em>pop3</em> lub <em>imap</em>, do samodzielnych demonów,
np. <em>nntp</em>, <em>smtp</em> lub <em>http</em>, a nawet tunelowaæ ppp poprzez gniazda sieciowe
bez zmian w kodzie ¼ród³owym.</p>
<p>
</p>
<hr />
<h1><a name="opcje">OPCJE</a></h1>
<dl>
<dt><strong><a name="plik" class="item">&lt;<strong>plik</strong>&gt;</a></strong></dt>

<dd>
<p>u¿yj podanego pliku konfiguracyjnego</p>
</dd>
<dt><strong><a name="n" class="item"><strong>-fd n</strong> (tylko Unix)</a></strong></dt>

<dd>
<p>wczytaj konfiguracjê z podanego deskryptora pliku</p>
</dd>
<dt><strong><a name="help" class="item"><strong>-help</strong></a></strong></dt>

<dd>
<p>drukuj listê wspieranych opcji</p>
</dd>
<dt><strong><a name="version" class="item"><strong>-version</strong></a></strong></dt>

<dd>
<p>drukuj wersjê programu i domy¶lne warto¶ci parametrów</p>
</dd>
<dt><strong><a name="sockets" class="item"><strong>-sockets</strong></a></strong></dt>

<dd>
<p>drukuj domy¶lne opcje gniazd</p>
</dd>
<dt><strong><a name="install" class="item"><strong>-install</strong> (tylko NT/2000/XP)</a></strong></dt>

<dd>
<p>instaluj serwis NT</p>
</dd>
<dt><strong><a name="uninstall" class="item"><strong>-uninstall</strong> (tylko NT/2000/XP)</a></strong></dt>

<dd>
<p>odinstaluj serwis NT</p>
</dd>
<dt><strong><a name="start" class="item"><strong>-start</strong> (tylko NT/2000/XP)</a></strong></dt>

<dd>
<p>uruchom serwis NT</p>
</dd>
<dt><strong><a name="stop" class="item"><strong>-stop</strong> (tylko NT/2000/XP)</a></strong></dt>

<dd>
<p>zatrzymaj serwis NT</p>
</dd>
<dt><strong><a name="quiet" class="item"><strong>-quiet</strong> (tylko NT/2000/XP)</a></strong></dt>

<dd>
<p>nie wy¶wietlaj okienka informuj±cego o pomy¶lnym zainstalowaniu lub
odinstalowaniu</p>
</dd>
</dl>
<p>
</p>
<hr />
<h1><a name="plik_konfiguracyjny">PLIK KONFIGURACYJNY</a></h1>
<p>Linia w pliku konfiguracyjnym mo¿e byæ:</p>
<ul>
<li>
<p>pusta (ignorowana)</p>
</li>
<li>
<p>komentarzem rozpoczynaj±cym siê znakiem ';' (ignorowana)</p>
</li>
<li>
<p>par± 'nazwa_opcji = warto¶æ_opcji'</p>
</li>
<li>
<p>tekstem '[nazwa_us³ugi]' wskazuj±cym pocz±tek definicji us³ugi</p>
</li>
</ul>
<p>
</p>
<h2><a name="opcje_globalne">OPCJE GLOBALNE</a></h2>
<dl>
<dt><strong><a name="katalog" class="item"><strong>chroot</strong> = katalog (tylko Unix)</a></strong></dt>

<dd>
<p>katalog roboczego korzenia systemu plików</p>
<p>Opcja okre¶la katalog, w którym uwiêziony zostanie proces programu
<strong>stunnel</strong> tu¿ po jego inicjalizacji, a przed rozpoczêciem odbierania
po³±czeñ.  ¦cie¿ki podane w opcjach <em>CApath</em>, <em>CRLpath</em>, <em>pid</em>
oraz <em>exec</em> musz± byæ umieszczone wewn±trz katalogu podanego w opcji
<em>chroot</em> i okre¶lone wzglêdem tego katalogu.</p>
<p>W przypadku wykorzystania kontroli dostêpu przy pomocy biblioteki
libwrap (TCP wrappers) jej pliki konfiguracyjne (/etc/hosts.allow i
/etc/hosts.deny) musz± zostaæ skopiowane do podkatalogu etc/
umieszczonego wewn±trz katalogu podanego w opcji <em>chroot</em>.</p>
</dd>
<dt><strong><a name="compression_zlib_rle" class="item"><strong>compression</strong> = zlib | rle</a></strong></dt>

<dd>
<p>wybór algorytmu kompresji przesy³anych danych</p>
<p>domy¶lnie: bez kompresji</p>
<p>Kompresja zlib zaimplementowana w OpenSSL 0.9.8 i nowszych nie jest
kompatybilna implementacj± OpenSSL 0.9.7.</p>
<p>Kompresja rle nie jest zaimplementowana w aktualnych wersjach OpenSSL.</p>
</dd>
<dt><strong><a name="debug_poziom_podsystem" class="item"><strong>debug</strong> = poziom[.podsystem]</a></strong></dt>

<dd>
<p>szczegó³owo¶æ logowania</p>
<p>Poziom logowania mo¿na okre¶liæ przy pomocy jednej z nazw lub liczb:
emerg (0), alert (1), crit (2), err (3), warning (4), notice (5),
info (6) lub debug (7).
Zapisywane s± komunikaty o poziomie ni¿szym (numerycznie) lub równym podanemu.
Do uzyskania najwy¿szego poziomu szczegó³owo¶ci mo¿na u¿yæ opcji
<strong>debug = debug</strong> lub <strong>debug = 7</strong>.  Domy¶lnym poziomem jest notice (5).</p>
<p>O ile nie wyspecyfikowano podsystemu u¿yty bêdzie domy¶lny: daemon.
Podsystemy nie s± wspierane przez platformê Win32.</p>
<p>Wielko¶æ liter jest ignorowana zarówno dla poziomu jak podsystemu.</p>
</dd>
<dt><strong><a name="ka_do_egd" class="item"><strong>EGD</strong> = ¶cie¿ka_do_EGD (tylko Unix)</a></strong></dt>

<dd>
<p>¶cie¿ka do gniazda programu Entropy Gathering Daemon</p>
<p>Opcja pozwala okre¶liæ ¶cie¿kê do gniazda programu Entropy Gathering Daemon
u¿ywanego do zainicjalizowania generatora ci±gów pseudolosowych biblioteki
OpenSSL.  Opcja jest dostêpna z bibliotek± OpenSSL 0.9.5a lub nowsz±.</p>
</dd>
<dt><strong><a name="engine_auto_identyfikator_urz_dzenia" class="item"><strong>engine</strong> = auto | &lt;identyfikator urz±dzenia&gt;</a></strong></dt>

<dd>
<p>wybór sprzêtowego urz±dzenia kryptograficznego</p>
<p>domy¶lnie: bez wykorzystania urz±dzeñ kryptograficznych</p>
<p>Przyk³ad wykorzystania w sekcji 'PRZYK£ADY'.</p>
</dd>
<dt><strong><a name="enginectrl_command_parameter" class="item"><strong>engineCtrl</strong> = &lt;command&gt;[:&lt;parameter&gt;]</a></strong></dt>

<dd>
<p>konfiguracja urz±dzenia kryptograficznego</p>
<p>Specjalne komendy &quot;LOAD&quot; i &quot;INIT&quot; pozwalaj± na za³adowanie i inicjalizacjê
modu³u kryptograficznego urz±dzenia.</p>
</dd>
<dt><strong><a name="fips_yes_no" class="item"><strong>fips</strong> = yes | no</a></strong></dt>

<dd>
<p>W³±cz lub wy³±cz tryb FIPS 140-2.</p>
<p>Opcja pozwala wy³±czyæ wej¶cie w tryb FIPS, je¶li stunnel zosta³ skompilowany
ze wsparciem dla FIPS 140-2.</p>
<p>domy¶lnie: yes (pracuj w trybie FIPS 140-2)</p>
</dd>
<dt><strong><a name="no" class="item"><strong>foreground</strong> = yes | no (tylko Unix)</a></strong></dt>

<dd>
<p>tryb pierwszoplanowy</p>
<p>U¿ycie tej opcji powoduje, ¿e <em>stunnel</em> nie przechodzi w t³o loguj±c
swoje komunikaty na konsolê zamiast przez <em>syslog</em> (o ile nie u¿yto
opcji <em>output</em>).</p>
</dd>
<dt><strong><a name="output_plik" class="item"><strong>output</strong> = plik</a></strong></dt>

<dd>
<p>plik, do którego dopisane zostan± logi</p>
<p>U¿ycie tej opcji zmienia domy¶lne zachowanie programu polegaj±ce
na logowaniu swoich komunikatów poprzez syslog.</p>
<p>Do przekierowania komunikatów na standardowe wyj¶cie (na przyk³ad po to,
¿eby zalogowaæ je programem splogger z pakietu daemontools) mo¿na podaæ
jako parametr urz±dzenie /dev/stdout.</p>
</dd>
<dt><strong><strong>pid</strong> = plik (tylko Unix)</strong></dt>

<dd>
<p>po³o¿enie pliku z numerem procesu</p>
<p>Je¿eli argument jest pusty plik nie zostanie stworzony.</p>
<p>Je¿eli zdefiniowano katalog <em>chroot</em>, to ¶cie¿ka do <em>pid</em> jest okre¶lona
wzglêdem tego katalogu.</p>
</dd>
<dt><strong><a name="rndbytes_liczba_bajt_w" class="item"><strong>RNDbytes</strong> = liczba_bajtów</a></strong></dt>

<dd>
<p>liczba bajtów do zainicjowania generatora pseudolosowego</p>
<p>W wersjach biblioteki OpenSSL starszych ni¿ 0.9.5a opcja ta okre¶la
równie¿ liczbê bajtów wystarczaj±cych do zainicjowania PRNG.
Nowsze wersje biblioteki maj± wbudowan± funkcjê okre¶laj±c±, czy
dostarczona ilo¶æ losowo¶ci jest wystarczaj±ca do zainicjowania generatora.</p>
</dd>
<dt><strong><a name="rndfile_plik" class="item"><strong>RNDfile</strong> = plik</a></strong></dt>

<dd>
<p>¶cie¿ka do pliku zawieraj±cego losowe dane</p>
<p>Biblioteka OpenSSL u¿yje danych z tego pliku do zainicjowania
generatora pseudolosowego.</p>
</dd>
<dt><strong><a name="rndoverwrite_yes_no" class="item"><strong>RNDoverwrite</strong> = yes | no</a></strong></dt>

<dd>
<p>nadpisz plik nowymi warto¶ciami pseudolosowymi</p>
<p>domy¶lnie: yes (nadpisz)</p>
</dd>
<dt><strong><a name="service_nazwa_serwisu" class="item"><strong>service</strong> = nazwa_serwisu</a></strong></dt>

<dd>
<p>u¿yj parametru jako nazwy serwisu</p>
<p><strong>Unix:</strong> nazwa serwisu dla biblioteki TCP Wrapper w trybie <em>inetd</em>.</p>
<p><strong>NT/2000/XP:</strong> nazwa serwisu NT w Panelu Sterowania.</p>
<p>domy¶lnie: stunnel</p>
</dd>
<dt><strong><a name="identyfikator_grupy" class="item"><strong>setgid</strong> = identyfikator_grupy (tylko Unix)</a></strong></dt>

<dd>
<p>grupa z której prawami pracowa³ bêdzie <em>stunnel</em></p>
</dd>
<dt><strong><a name="ytkownika" class="item"><strong>setuid</strong> = identyfikator_u¿ytkownika (tylko Unix)</a></strong></dt>

<dd>
<p>u¿ytkownik, z którego prawami pracowa³ bêdzie <em>stunnel</em></p>
</dd>
<dt><strong><a name="socket_a_l_r_option_value_value" class="item"><strong>socket</strong> = a|l|r:option=value[:value]</a></strong></dt>

<dd>
<p>ustaw opcjê na akceptuj±cym/lokalnym/zdalnym gnie¼dzie</p>
<p>Dla opcji linger warto¶ci maj± postaæ l_onof:l_linger.
Dla opcji time warto¶ci maj± postaæ tv_sec:tv_usec.</p>
<p>Przyk³ady:</p>
<pre>
    socket = l:SO_LINGER=1:60
        ustaw jednominutowe przeterminowanie
        przy zamykaniu lokalnego gniazda
    socket = r:TCP_NODELAY=1
        wy³±cz algorytm Nagle'a na zdalnych
        gniazdach
    socket = r:SO_OOBINLINE=1
        umie¶æ dane pozapasmowe (out-of-band)
        bezpo¶rednio w strumieniu danych
        wej¶ciowych dla zdalnych gniazd
    socket = a:SO_REUSEADDR=0
        zablokuj ponowne u¿ywanie portu
        (domy¶lnie w³±czone)
    socket = a:SO_BINDTODEVICE=lo
        przyjmuj po³±czenia wy³±cznie na
        interfejsie zwrotnym (ang. loopback)</pre>
</dd>
<dt><strong><strong>syslog</strong> = yes | no (tylko Unix)</strong></dt>

<dd>
<p>w³±cz logowanie poprzez mechanizm syslog</p>
<p>domy¶lnie: yes (w³±cz)</p>
</dd>
<dt><strong><strong>taskbar</strong> = yes | no (tylko WIN32)</strong></dt>

<dd>
<p>w³±cz ikonkê w prawym dolnym rogu ekranu</p>
<p>domy¶lnie: yes (w³±cz)</p>
</dd>
</dl>
<p>
</p>
<h2><a name="opcje_us_ug">OPCJE US£UG</a></h2>
<p>Ka¿da sekcja konfiguracji us³ugi zaczyna siê jej nazw± ujêt± w nawias
kwadratowy.  Nazwa us³ugi u¿ywana jest do kontroli dostêpu przez
bibliotekê libwrap (TCP wrappers) oraz pozwala rozró¿niæ poszczególne
us³ugi w logach.</p>
<p>Je¿eli <strong>stunnel</strong> ma zostaæ u¿yty w trybie <em>inetd</em>, gdzie za odebranie
po³±czenia odpowiada osobny program (zwykle <em>inetd</em>, <em>xinetd</em>
lub <em>tcpserver</em>), nale¿y przeczytaæ sekcjê <strong>TRYB INETD</strong> poni¿ej.</p>
<dl>
<dt><strong><a name="accept_adres_port" class="item"><strong>accept</strong> = [adres:]port</a></strong></dt>

<dd>
<p>nas³uchuje na po³±czenia na podanym adresie i porcie</p>
<p>Je¿eli nie zosta³ podany adres, <em>stunnel</em> domy¶lnie nas³uchuje
na wszystkich adresach IP lokalnych interfejsów.</p>
</dd>
<dt><strong><a name="capath_katalog_ca" class="item"><strong>CApath</strong> = katalog_CA</a></strong></dt>

<dd>
<p>katalog Centrum Certyfikacji</p>
<p>Opcja okre¶la katalog, w którym <strong>stunnel</strong> bêdzie szuka³ certyfikatów,
je¿eli u¿yta zosta³a opcja <em>verify</em>.  Pliki z certyfikatami musz±
posiadaæ specjalne nazwy XXXXXXXX.0, gdzie XXXXXXXX jest skrótem
kryptograficznym reprezentacji DER nazwy podmiotu certyfikatu
(4 pierwsze bajty skrótu MD5 pocz±wszy od najmniej znaczacego).</p>
<p>Je¿eli zdefiniowano katalog <em>chroot</em>, to ¶cie¿ka do <em>CApath</em> jest okre¶lona
wzglêdem tego katalogu.</p>
</dd>
<dt><strong><a name="cafile_plik_ca" class="item"><strong>CAfile</strong> = plik_CA</a></strong></dt>

<dd>
<p>plik Centrum Certyfikacji</p>
<p>Opcja pozwala okre¶liæ po³o¿enie pliku zawieraj±cego certyfikaty u¿ywane
przez opcjê <em>verify</em>.</p>
</dd>
<dt><strong><a name="cert_plik_pem" class="item"><strong>cert</strong> = plik_pem</a></strong></dt>

<dd>
<p>plik z ³añcuchem certyfikatów</p>
<p>Opcja okre¶la po³o¿enie pliku zawieraj±cego certyfikaty u¿ywane przez
program <strong>stunnel</strong> do uwierzytelnienia siê przed drug± stron± po³±czenia.
Certyfikat jest konieczny, aby u¿ywaæ programu w trybie serwera.
W trybie klienta certyfikat jest opcjonalny.</p>
</dd>
<dt><strong><a name="ciphers_lista_szyfr_w" class="item"><strong>ciphers</strong> = lista_szyfrów</a></strong></dt>

<dd>
<p>lista dozwolonych szyfrów SSL</p>
<p>Parametrem tej opcji jest lista szyfrów, które bêd± u¿yte przy
otwieraniu nowych po³±czeñ SSL, np.:  DES-CBC3-SHA:IDEA-CBC-MD5</p>
</dd>
<dt><strong><a name="client_yes_no" class="item"><strong>client</strong> = yes | no</a></strong></dt>

<dd>
<p>tryb kliencki (zdalna us³uga u¿ywa SSL)</p>
<p>domy¶lnie: no (tryb serwerowy)</p>
</dd>
<dt><strong><a name="connect_adres_port" class="item"><strong>connect</strong> = [adres:]port</a></strong></dt>

<dd>
<p>po³±cz siê ze zdalnym serwerem na podany port</p>
<p>Je¿eli nie zosta³ podany adres, <em>stunnel</em> domy¶lnie ³±czy siê
z lokalnym serwerem.</p>
<p>Komenda mo¿e byc u¿yta wielokrotnie w pojedynczej sekcji
celem zapewnienia wysokiej niezawodno¶ci lub roz³o¿enia
ruchu pomiêdzy wiele serwerów.</p>
</dd>
<dt><strong><a name="crlpath_katalog_crl" class="item"><strong>CRLpath</strong> = katalog_CRL</a></strong></dt>

<dd>
<p>katalog List Odwo³anych Certyfikatów (CRL)</p>
<p>Opcja okre¶la katalog, w którym <strong>stunnel</strong> bêdzie szuka³ list CRL,
je¿eli u¿yta zosta³a opcja <em>verify</em>.  Pliki z listami CRL musz±
posiadaæ specjalne nazwy XXXXXXXX.0, gdzie XXXXXXXX jest skrótem
listy CRL.</p>
<p>Je¿eli zdefiniowano katalog <em>chroot</em>, to ¶cie¿ka do <em>CRLpath</em> jest okre¶lona
wzglêdem tego katalogu.</p>
</dd>
<dt><strong><a name="crlfile_plik_crl" class="item"><strong>CRLfile</strong> = plik_CRL</a></strong></dt>

<dd>
<p>plik List Odwo³anych Certyfikatów (CRL)</p>
<p>Opcja pozwala okre¶liæ po³o¿enie pliku zawieraj±cego listy CRL u¿ywane
przez opcjê <em>verify</em>.</p>
</dd>
<dt><strong><a name="delay_yes_no" class="item"><strong>delay</strong> = yes | no</a></strong></dt>

<dd>
<p>opó¼nij rozwiniêcie adresu DNS podanego w opcji <em>connect</em></p>
</dd>
<dt><strong><a name="enginenum_numer_urz_dzenia" class="item"><strong>engineNum</strong> = &lt;numer urz±dzenia&gt;</a></strong></dt>

<dd>
<p>wybierz urz±dzenie do odczyta klucza prywatnego</p>
<p>Urz±dzenia s± numerowane od 1 w górê.</p>
</dd>
<dt><strong><a name="ka_do_programu" class="item"><strong>exec</strong> = ¶cie¿ka_do_programu (tylko Unix)</a></strong></dt>

<dd>
<p>wykonaj lokalny program przystosowany do pracy z superdemonem inetd</p>
<p>Je¿eli zdefiniowano katalog <em>chroot</em>, to ¶cie¿ka do <em>exec</em> jest okre¶lona
wzglêdem tego katalogu.</p>
</dd>
<dt><strong><a name="execargs_0_1_2_tylko_unix" class="item"><strong>execargs</strong> = $0 $1 $2 ... (tylko Unix)</a></strong></dt>

<dd>
<p>argumenty do opcji <em>exec</em> w³±cznie z nazw± programu ($0)</p>
<p>Cytowanie nie jest wspierane w obecnej wersji programu.
Argumenty s± rozdzielone dowoln± liczb± bia³ych znaków.</p>
</dd>
<dt><strong><a name="failover_rr_prio" class="item"><strong>failover</strong> = rr | prio</a></strong></dt>

<dd>
<p>Strategia wybierania serwerów wyspecyfikowanych parametrami &quot;connect&quot;.</p>
<pre>
    rr (round robin) - sprawiedliwe roz³o¿enie obci±¿enia
    prio (priority) - u¿yj kolejno¶ci opcji w pliku konfiguracyjnym</pre>
<p>domy¶lnie: rr</p>
</dd>
<dt><strong><a name="ident_nazwa_u_ytkownika" class="item"><strong>ident</strong> = nazwa_u¿ytkownika</a></strong></dt>

<dd>
<p>weryfikuj nazwê zdalnego u¿ytkownika korzystaj±c z protoko³u IDENT (<a href="http://www.ietf.org/rfc/rfc1413.txt" class="rfc">RFC 1413</a>)</p>
</dd>
<dt><strong><a name="key_plik_klucza" class="item"><strong>key</strong> = plik_klucza</a></strong></dt>

<dd>
<p>klucz prywatny do certyfikatu podanego w opcji <em>cert</em></p>
<p>Klucz prywatny jest potrzebny do uwierzytelnienia w³a¶ciciela certyfikatu.
Poniewa¿ powinien on byæ zachowany w tajemnicy, prawa do jego odczytu
powinien mieæ wy³±cznie w³a¶ciciel pliku.  W systemie Unix mo¿na to osi±gn±æ
komend±:</p>
<pre>
    chmod 600 keyfile</pre>
<p>domy¶lnie: warto¶æ opcji <em>cert</em></p>
</dd>
<dt><strong><a name="local_serwer" class="item"><strong>local</strong> = serwer</a></strong></dt>

<dd>
<p>IP ¼ród³a do nawi±zywania zdalnych po³±czeñ</p>
<p>Domy¶lnie u¿ywane jest IP najbardziej zewnêtrznego interfejsu w stronê
serwera, do którego nawi±zywane jest po³±czenie.</p>
</dd>
<dt><strong><a name="ocsp_url" class="item"><strong>OCSP</strong> = URL</a></strong></dt>

<dd>
<p>serwer OCSP do weryfikacji certyfikatów</p>
</dd>
<dt><strong><a name="ocspflag_flaga" class="item"><strong>OCSPflag</strong> = flaga</a></strong></dt>

<dd>
<p>flaga serwera OCSP</p>
<p>aktualnie wspierane flagi: NOCERTS, NOINTERN NOSIGS, NOCHAIN, NOVERIFY,
NOEXPLICIT, NOCASIGN, NODELEGATED, NOCHECKS, TRUSTOTHER, RESPID_KEY, NOTIME</p>
<p>Aby wyspecyfikowaæ kilka flag nale¿y u¿yæ <em>OCSPflag</em> wielokrotnie.</p>
</dd>
<dt><strong><a name="options_opcje_ssl" class="item"><strong>options</strong> = opcje_SSL</a></strong></dt>

<dd>
<p>opcje biblioteki OpenSSL</p>
<p>Parametrem jest nazwa opcji zgodnie z opisem w <em>SSL_CTX_set_options(3ssl)</em>,
ale bez przedrostka <em>SSL_OP_</em>.
Aby wyspecyfikowaæ kilka opcji nale¿y u¿yæ <em>options</em> wielokrotnie.</p>
<p>Na przyk³ad dla zachowania kompatybilno¶ci z b³êdami implementacji SSL
w programie Eudora mo¿na u¿yæ opcji:</p>
<pre>
    options = DONT_INSERT_EMPTY_FRAGMENTS</pre>
</dd>
<dt><strong><a name="protocol_protok" class="item"><strong>protocol</strong> = protokó³</a></strong></dt>

<dd>
<p>negocjuj SSL podanym protoko³em aplikacyjnym</p>
<p>aktualnie wspierane protoko³y: cifs, connect, imap, nntp, pop3, smtp, pgsql</p>
</dd>
<dt><strong><a name="protocolauthentication_uwierzytelnienie" class="item"><strong>protocolAuthentication</strong> = uwierzytelnienie</a></strong></dt>

<dd>
<p>rodzaj uwierzytelnienia do negocjacji protoko³u</p>
<p>aktualnie wspierane: basic, NTLM</p>
<p>Obecnie typ uwierzytelnienia ma zastosowanie wy³±cznie w protokole 'connect'.</p>
<p>domy¶lnie: basic</p>
</dd>
<dt><strong><a name="protocolhost_adres_port" class="item"><strong>protocolHost</strong> = adres:port</a></strong></dt>

<dd>
<p>adres docelowy do negocjacji protoko³u</p>
</dd>
<dt><strong><a name="protocolpassword_has_o" class="item"><strong>protocolPassword</strong> = has³o</a></strong></dt>

<dd>
<p>has³o do negocjacji protoko³u</p>
</dd>
<dt><strong><a name="protocolusername_u_ytkownik" class="item"><strong>protocolUsername</strong> = u¿ytkownik</a></strong></dt>

<dd>
<p>nazwa u¿ytkownika do negocjacji protoko³u</p>
</dd>
<dt><strong><strong>pty</strong> = yes | no (tylko Unix)</strong></dt>

<dd>
<p>alokuj pseudoterminal dla programu uruchamianego w opcji 'exec'</p>
</dd>
<dt><strong><strong>retry</strong> = yes | no (tylko Unix)</strong></dt>

<dd>
<p>po³±cz ponownie sekcjê connect+exec po roz³±czeniu</p>
<p>domy¶lnie: no</p>
</dd>
<dt><strong><a name="session_przeterminowanie_pami_ci_podr_cznej_sesji" class="item"><strong>session</strong> = przeterminowanie_pamiêci_podrêcznej_sesji</a></strong></dt>

<dd>
<p>czas w sekundach, po którym sesja SSL zostanie usuniêta z pamiêci podrêcznej</p>
</dd>
<dt><strong><a name="sessiond_adres_port" class="item"><strong>sessiond</strong> = adres:port</a></strong></dt>

<dd>
<p>adres sessiond - servera cache sesji SSL</p>
</dd>
<dt><strong><a name="sslversion_wersja" class="item"><strong>sslVersion</strong> = wersja</a></strong></dt>

<dd>
<p>wersja protoko³u SSL</p>
<p>Dozwolone opcje: all, SSLv2, SSLv3, TLSv1</p>
</dd>
<dt><strong><a name="w" class="item"><strong>stack</strong> = liczba_bajtów (z wyj±tkiem modelu FORK)</a></strong></dt>

<dd>
<p>rozmiar stosu procesora w±tku</p>
</dd>
<dt><strong><a name="timeoutbusy_liczba_sekund" class="item"><strong>TIMEOUTbusy</strong> = liczba_sekund</a></strong></dt>

<dd>
<p>czas oczekiwania na spodziewane dane</p>
</dd>
<dt><strong><a name="timeoutclose_liczba_sekund" class="item"><strong>TIMEOUTclose</strong> = liczba_sekund</a></strong></dt>

<dd>
<p>czas oczekiwania na close_notify (ustaw na 0, je¿eli klientem jest MSIE)</p>
</dd>
<dt><strong><a name="timeoutconnect_liczba_sekund" class="item"><strong>TIMEOUTconnect</strong> = liczba_sekund</a></strong></dt>

<dd>
<p>czas oczekiwania na nawi±zanie po³±czenia</p>
</dd>
<dt><strong><a name="timeoutidle_liczba_sekund" class="item"><strong>TIMEOUTidle</strong> = liczba_sekund</a></strong></dt>

<dd>
<p>maksymalny czas utrzymywania bezczynnego po³±czenia</p>
</dd>
<dt><strong><strong>transparent</strong> = yes | no (tylko Unix)</strong></dt>

<dd>
<p>tryb przezroczystego proxy</p>
<p>Przepisz adres, aby nawi±zywane po³±czenie wydawa³o siê pochodziæ
bezpo¶rednio od klienta, a nie od programu <em>stunnel</em>.</p>
<p>Opcja jest aktualnie obs³ugiwana w:</p>
<pre>
    trybie zdalnym (opcja I&lt;connect&gt; na j±drze Linux &gt;=2.6.28
    trybie zdalnym (opcja I&lt;connect&gt; na j±drze Linux 2.2.x
    trybie lokalnym (opcja I&lt;exec&gt;)</pre>
<p><strong>Tryb zdalny</strong> (zarówno 2.2.x jak i &gt;=2.6.28) wymaga, aby stunnel by³ pracowa³
z prawami u¿ytkownika root.  W szczególno¶ci opcja <strong>setuid</strong> nie pozwoli na
pracê przezroczystego proxy.</p>
<p><strong>Linux &gt;=2.6.28</strong> wymaga nastêpuj±cych ustawieñ iptables oraz routingu
(na przyk³ad w pliku /etc/rc.local lub analogicznym):</p>
<pre>
    iptables -t mangle -N DIVERT
    iptables -t mangle -A PREROUTING -p tcp -m socket -j DIVERT
    iptables -t mangle -A DIVERT -j MARK --set-mark 1
    iptables -t mangle -A DIVERT -j ACCEPT
    ip rule add fwmark 1 lookup 100
    ip route add local 0.0.0.0/0 dev lo table 100</pre>
<p><strong>Linux 2.2.x</strong> wymaga skompilowania j±dra z opcj± <em>transparent proxy</em>.
Docelowa us³uga musi byæ umieszczona na osobnej maszynie, do której routing
kierowany jest poprzez serwer stunnela.</p>
<p><strong>Tryb lokalny</strong> jest realizowany poprzez za³adowanie przy pomocy LD_PRELOAD
biblioteki env.so.</p>
</dd>
<dt><strong><a name="verify_poziom" class="item"><strong>verify</strong> = poziom</a></strong></dt>

<dd>
<p>weryfikuj certyfikat drugiej strony po³±czenia</p>
<pre>
    poziom 1 - weryfikuj, je¿eli zosta³
        przedstawiony
    poziom 2 - weryfikuj z zainstalowanym
        certyfikatem Centrum Certyfikacji
    poziom 3 - weryfikuj z lokalnie
        zainstalowanym certyfikatem drugiej strony
    domy¶lnie - nie weryfikuj</pre>
</dd>
</dl>
<p>
</p>
<hr />
<h1><a name="zwracana_warto__">ZWRACANA WARTO¦Æ</a></h1>
<p><strong>stunnel</strong> zwraca zero w przypadku sukcesu, lub warto¶æ niezerow±
w przypadku b³êdu.</p>
<p>
</p>
<hr />
<h1><a name="przyk_ady">PRZYK£ADY</a></h1>
<p>Szyfrowanie po³±czeñ do lokalnego serwera <em>imapd</em> mo¿na u¿yæ:</p>
<pre>
    [imapd]
    accept = 993
    exec = /usr/sbin/imapd
    execargs = imapd</pre>
<p>albo w trybie zdalnym:</p>
<pre>
    [imapd]
    accept = 993
    connect = 143</pre>
<p>W po³±czeniu z programem <em>pppd</em> <strong>stunnel</strong> pozwala zestawiæ prosty VPN.
Po stronie serwera nas³uchuj±cego na porcie 2020 jego konfiguracja
mo¿e wygl±daæ nastêpuj±co:</p>
<pre>
    [vpn]
    accept = 2020
    exec = /usr/sbin/pppd
    execargs = pppd local
    pty = yes</pre>
<p>Poni¿szy plik konfiguracyjny mo¿e byæ wykorzystany do uruchomienia
programu <strong>stunnel</strong> w trybie <em>inetd</em>.  Warto zauwa¿yæ, ¿e w pliku
konfiguracyjnym nie ma sekcji <em>[nazwa_us³ugi]</em>.</p>
<pre>
    exec = /usr/sbin/imapd
    execargs = imapd</pre>
<p>Przyk³adowa konfiguracja umo¿liwiaj±ca odczytanie klucza prywatnego z
urz±dzenia zgodnego z OpenSC</p>
<pre>
    engine=dynamic
    engineCtrl=SO_PATH:/usr/lib/opensc/engine_pkcs11.so
    engineCtrl=ID:pkcs11
    engineCtrl=LIST_ADD:1
    engineCtrl=LOAD
    engineCtrl=MODULE_PATH:/usr/lib/pkcs11/opensc-pkcs11.so
    engineCtrl=INIT</pre>
<pre>
    [service]
    engineNum=1
    key=id_45</pre>
<p>
</p>
<hr />
<h1><a name="pliki">PLIKI</a></h1>
<dl>
<dt><strong><a name="stunnel_conf" class="item"><em class="file">stunnel.conf</em></a></strong></dt>

<dd>
<p>plik konfiguracyjny programu</p>
</dd>
<dt><strong><a name="stunnel_pem" class="item"><em class="file">stunnel.pem</em></a></strong></dt>

<dd>
<p>certyfikat i klucz prywatny</p>
</dd>
</dl>
<p>
</p>
<hr />
<h1><a name="b__dy">B£ÊDY</a></h1>
<p>Opcja <em>execargs</em> nie obs³uguje cytowania.</p>
<p>
</p>
<hr />
<h1><a name="ograniczenia">OGRANICZENIA</a></h1>
<p><em>stunnel</em> nie mo¿e byæ u¿ywany do szyfrowania protoko³u <em>FTP</em>,
poniewa¿ do przesy³ania poszczególnych plików u¿ywa on dodatkowych
po³±czeñ otwieranych na portach o dynamicznie przydzielanych numerach.
Istniej± jednak specjalne wersje klientów i serwerów FTP pozwalaj±ce
na szyfrowanie przesy³anych danych przy pomocy protoko³u <em>SSL</em>.</p>
<p>
</p>
<hr />
<h1><a name="notki">NOTKI</a></h1>
<p>
</p>
<h2><a name="tryb_inetd__tylko_unix_">TRYB INETD (tylko Unix)</a></h2>
<p>W wiêkszo¶ci zastosowañ <strong>stunnel</strong> samodzielnie nas³uchuje na porcie
podanym w pliku konfiguracyjnym i tworzy po³±czenie z innym portem
podanym w opcji <em>connect</em> lub nowym programem podanym w opcji <em>exec</em>.
Niektórzy wol± jednak wykorzystywaæ oddzielny program, który odbiera
po³±czenia, po czym uruchamia program <strong>stunnel</strong>.  Przyk³adami takich
programów s± inetd, xinetd i tcpserver.</p>
<p>Przyk³adowa linia pliku /etc/inetd.conf mo¿e wygl±daæ tak:</p>
<pre>
    imaps stream tcp nowait root /usr/bin/stunnel
        stunnel /etc/stunnel/imaps.conf</pre>
<p>Poniewa¿ w takich przypadkach po³±czenie na zdefiniowanym porcie
(tutaj <em>imaps</em>) nawi±zuje osobny program (tutaj <em>inetd</em>), <strong>stunnel</strong>
nie mo¿e u¿ywaæ opcji <em>accept</em>.  W pliku konfiguracyjnym nie mo¿e
byæ równie¿ zdefiniowana ¿adna us³uga (<em>[nazwa_us³ugi]</em>), poniewa¿
konfiguracja taka pozwala na nawi±zanie tylko jednego po³±czenia.
Wszystkie <em>OPCJE US£UG</em> powinny byæ umieszczone razem z opcjami
globalnymi.  Przyk³ad takiej konfiguracji znajduje siê w sekcji
<em>PRZYK£ADY</em>.</p>
<p>
</p>
<h2><a name="certyfikaty">CERTYFIKATY</a></h2>
<p>Protokó³ SSL wymaga, aby ka¿dy serwer przedstawia³ siê nawi±zuj±cemu
po³±czenie klientowi prawid³owym certyfikatem X.509.
Potwierdzenie to¿samo¶ci serwera polega na wykazaniu, ¿e posiada on
odpowiadaj±cy certyfikatowi klucz prywatny.
Najprostsz± metod± uzyskania certyfikatu jest wygenerowanie
go przy pomocy wolnego pakietu <em>OpenSSL</em>.  Wiêcej informacji na temat
generowania certyfikatów mo¿na znale¼æ na umieszczonych poni¿ej stronach.</p>
<p>Istotn± kwesti± jest kolejno¶æ zawarto¶ci pliku <em>.pem</em>.
W pierwszej kolejno¶ci powinien on zawieraæ klucz prywatny,
a dopiero za nim podpisany certyfikat (nie ¿±danie certyfikatu).
Po certyfikacie i kluczu prywatnym powinny znajdowaæ siê puste linie.
Je¿eli przed certyfikatem znajduj± siê dodatkowe informacje tekstowe,
to powinny one zostaæ usuniête.  Otrzymany plik powinien mieæ
nastêpuj±c± postaæ:</p>
<pre>
    -----BEGIN RSA PRIVATE KEY-----
    [zakodowany klucz]
    -----END RSA PRIVATE KEY-----
    [pusta linia]
    -----BEGIN CERTIFICATE-----
    [zakodowany certyfikat]
    -----END CERTIFICATE-----
    [pusta linia]</pre>
<p>
</p>
<h2><a name="losowo__">LOSOWO¦Æ</a></h2>
<p><strong>stunnel</strong> potrzebuje zainicjowaæ PRNG (generator liczb pseudolosowych),
gdy¿ protokó³ SSL wymaga do bezpieczeñstwa kryptograficznego ¼ród³a
dobrej losowo¶ci.  Nastêpuj±ce ¼ród³a s± kolejno odczytywane a¿ do
uzyskania  wystarczaj±cej ilo¶ci entropii:</p>
<ul>
<li>
<p>Zawarto¶æ pliku podanego w opcji <em>RNDfile</em>.</p>
</li>
<li>
<p>Zawarto¶æ pliku o nazwie okre¶lonej przez zmienn± ¶rodowiskow±
RANDFILE, o ile jest ona ustawiona.</p>
</li>
<li>
<p>Plik .rnd umieszczony w katalogu domowym u¿ytkownika,
je¿eli zmienna RANDFILE nie jest ustawiona.</p>
</li>
<li>
<p>Plik podany w opcji '--with-random' w czasie konfiguracji programu.</p>
</li>
<li>
<p>Zawarto¶æ ekranu w systemie Windows.</p>
</li>
<li>
<p>Gniazdo egd, je¿eli u¿yta zosta³a opcja <em>EGD</em>.</p>
</li>
<li>
<p>Gniazdo egd podane w opcji '--with-egd-socket' w czasie konfiguracji programu.</p>
</li>
<li>
<p>Urz±dzenie /dev/urandom.</p>
</li>
</ul>
<p>Wspó³czesne (&gt;=0.9.5a) wersje biblioteki <em>OpenSSL</em> automatycznie
zaprzestaj± ³adowania kolejnych danych w momencie uzyskania wystarczaj±cej
ilo¶ci entropii.  Wcze¶niejsze wersje biblioteki wykorzystaj± wszystkie
powy¿sze ¼ród³a, gdy¿ nie istnieje tam funkcja pozwalaj±ca okre¶liæ,
czy uzyskano ju¿ wystarczaj±co du¿o danych.</p>
<p>Warto zwróciæ uwagê, ¿e na maszynach z systemem Windows, na których
konsoli nie pracuje u¿ytkownik, zawarto¶æ ekranu nie jest wystarczaj±co
zmienna, aby zainicjowaæ PRNG.  W takim przypadku do zainicjowania
generatora nale¿y u¿yæ opcji <em>RNDfile</em>.</p>
<p>Plik <em>RNDfile</em> powinien zawieraæ dane losowe -- równie¿ w tym sensie,
¿e powinny byæ one inne przy ka¿dym uruchomieniu programu <strong>stunnel</strong>.
O ile nie u¿yta zosta³a opcja <em>RNDoverwrite</em> jest to robione
automatycznie.  Do rêcznego uzyskania takiego pliku u¿yteczna
mo¿e byæ komenda <em>openssl rand</em> dostarczana ze wspó³czesnymi
wersjami pakietu <em>OpenSSL</em>.</p>
<p>Jeszcze jedna istotna informacja -- je¿eli dostêpne jest urz±dzenie
<em>/dev/urandom</em> biblioteka <em>OpenSSL</em> ma zwyczaj zasilania nim PRNG w trakcie
sprawdzania stanu generatora.  W systemach z <em>/dev/urandom</em> urz±dzenie
to bêdzie najprawdopodobniej u¿yte, pomimo ¿e znajduje siê na samym koñcu
powy¿szej listy.  Jest to w³a¶ciwo¶æ biblioteki <em>OpenSSL</em>, a nie programu
<em>stunnel</em>.</p>
<p>
</p>
<hr />
<h1><a name="zobacz_r_wnie_">ZOBACZ RÓWNIE¯</a></h1>
<dl>
<dt><strong><a name="tcpd" class="item"><a href="#tcpd">tcpd(8)</a></a></strong></dt>

<dd>
<p>biblioteka kontroli dostêpu do us³ug internetowych</p>
</dd>
<dt><strong><a name="inetd" class="item"><a href="#inetd">inetd(8)</a></a></strong></dt>

<dd>
<p>'super-serwer' internetowy</p>
</dd>
<dt><strong><a name="http_stunnel_mirt_net" class="item"><em class="file"><a href="http://stunnel.mirt.net/">http://stunnel.mirt.net/</a></em></a></strong></dt>

<dd>
<p>strona domowa programu <em>stunnel</em></p>
</dd>
<dt><strong><a name="http_www_stunnel_org" class="item"><em class="file"><a href="http://www.stunnel.org/">http://www.stunnel.org/</a></em></a></strong></dt>

<dd>
<p>najczê¶ciej zadawane pytania na temat programu <em>stunnel</em></p>
</dd>
<dt><strong><a name="http_www_openssl_org" class="item"><em class="file"><a href="http://www.openssl.org/">http://www.openssl.org/</a></em></a></strong></dt>

<dd>
<p>strona projektu <em>OpenSSL</em></p>
</dd>
</dl>
<p>
</p>
<hr />
<h1><a name="autor">AUTOR</a></h1>
<dl>
<dt><strong><a name="micha_trojnara" class="item">Micha³ Trojnara</a></strong></dt>

<dd>
<p>&lt;<em class="file"><a href="mailto:Michal.Trojnara@mirt.net">Michal.Trojnara@mirt.net</a></em>&gt;</p>
</dd>
</dl>

</body>

</html>
